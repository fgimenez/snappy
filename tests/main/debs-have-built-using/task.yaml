summary: Ensure that our debs have the "built-using" header
systems: [-ubuntu-core-*]
execute: |
    if [ "$SRU_VALIDATION" -eq 1 ]; then
        # Do not run test case when we're running for SRU validation
        # as in that case we don't have a package available.
        exit 0
    fi
    out=$(dpkg -I $GOHOME/snapd_*.deb)
    if [[ "$SPREAD_SYSTEM" = ubuntu-* ]]; then
        # Apparmor & seccomp is only compiled in on Ubuntu for now.
        echo $out | MATCH "Built-Using:.*apparmor \(="
        echo $out | MATCH "Built-Using:.*libseccomp \(="
    fi
    echo $out | MATCH "Built-Using:.*libcap2 \(="
